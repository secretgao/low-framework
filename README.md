### 框架运行流程
1 入口文件
2 定义常量
3 引入函数库
4 自动加载类
5 返回结果
6 加载控制器
7 路由解析
8 启动框架

###一.简历下载
1.在线简历下载需要把html转pdf，这里用到了一个第三方开源组件[wkhtmltopdf](https://wkhtmltopdf.org/)。

>安装方式：官网选择对应版本[下载](https://wkhtmltopdf.org/downloads.html)，官方提供的是一个二进制包安装包，解压到指定文件夹即可，
在文件夹里面有一个 bin 目录，bin目录有一个 wkhtmltopdf 可执行文件。

安装完成后，在 conf 目录 pdf.ini 配置一下 wkhtmltopdf_bin 参数，参数内容为可执行文件的绝对路径！

例如：
```
wkhtmltopdf_bin = /data/webserver/wkhtmltox/bin/wkhtmltopdf
```

2.附件简历预览的时候需要把用户上传的word转换成pdf以方便前端处理，这里用到了 [libreoffice](https://www.libreoffice.org/) 组件的功能。

>安装方式：官网提供安装包下载，也可以直接用命令行从源安装

安装完成后，在 conf 目录 pdf.ini 配置一下 soffice_bin 参数，参数内容为 soffice 命令的绝对路径。

例如：
```
soffice_bin = /usr/bin/soffice
```


###二. 消息推送
1.站内消息推送使用的是慕课网的推送，所以主站启动了消息处理脚本就可以了
脚本位置： labs/shell/notice/createNotice.php


2.邮件和短信

邮件和短信推送这里使用了redis队列做了异步解耦，避免用户等待时间过长，使用了3个队列，一个是任务队列，一个是安全队列，一个是失败队列，具体处理流程如下：
1. 用户操作触发发短信和邮件事件，添加到任务队列
2. 后台执行脚本开始处理，首先取出一个任务，并把任务放入安全队列[这个操作是原子的]，如果任务处理成功，则删除安全队列里面的元素。如果处理失败，则不会删除安全队列的元素
3. 另外还有一个脚本定时启动用于处理安全队列，取出所有任务，判断该任务是否超过最大尝试次数（暂定3次），如果没有，则把尝试次数+1， 然后把任务放回任务队列。如果已经超过，则放入失败队列不再重试
4. 失败队列暂时并无实际用途，只做一个记录用，如果有需求可以导出数据人工手动处理

###可能存在的问题
如果短信和邮件发送程序本身不存在问题，这种策略可能会导致消息多发，但是不会少发

###目前配置的情况
以发送面试邀请为例，一个操作会触发2个短信和2个邮件，也就是4个任务，发送速度应该还算快，但是并发上来任务应该还挺多

目前脚本运行在227服务器，1个进程，如果任务积压过多，可多开进程
ssNoticeSafeQueue.php 由于处理安全队列，定时执行，每分钟执行一次即可